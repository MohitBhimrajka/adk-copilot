# Intelligent Support Triage System

An advanced multi-agent system built with the Google Agent Development Kit (ADK) to intelligently analyze, triage, and generate solutions for technical support tickets, specifically tailored for ADK developers.

  <!-- It's highly recommended to create and upload an architecture diagram -->

## Overview

This project demonstrates a sophisticated application of the multi-agent design pattern. An Orchestrator agent manages a team of specialized sub-agents to handle the entire lifecycle of a support ticketâ€”from initial analysis to retrieving information from multiple sources and generating a context-aware, professional response.

### Key Features

-   **Multi-Agent Architecture:** An Orchestrator agent manages a team of five specialist sub-agents, each with a distinct role in the support workflow.
-   **RAG-Powered Knowledge Base:** Utilizes Vertex AI RAG to search a comprehensive, auto-generated knowledge base of the official Google ADK documentation.
-   **Historical Data Search:** Connects to a BigQuery database to find solutions from previously resolved tickets, learning from past issues.
-   **Stateful, Multi-Turn Workflow:** Manages the ticket's state (`New`, `Analyzing`, `Pending Solution`) to ensure a logical and robust resolution process.
-   **Interactive Code Generation:** For requests requiring code, the system proposes an architecture before generating a complete, annotated script, improving accuracy and user satisfaction.
-   **Automated Environment Setup:** A single script handles the creation of all necessary data, cloud storage, BigQuery tables, and the RAG corpus, making setup seamless.

> **Note on Knowledge Base Content:** The knowledge base used by this agent is generated by scraping the publicly available [Google ADK documentation website](https://google.github.io/adk-docs/). All content rights belong to the original authors. This project uses the content for demonstration and educational purposes in accordance with fair use principles. The scraped data is provided as-is and may not be perfectly formatted or up-to-date.

## Agent Architecture

The system is orchestrated by a main `orchestrator_agent` which delegates tasks to the following specialists:

1.  **`ticket_analysis_agent`**: Reads the initial user request and enriches the ticket with structured data (urgency, category, sentiment, summary).
2.  **`knowledge_retrieval_agent`**: Performs a semantic search against the official ADK documentation (ingested into a Vertex AI RAG Corpus) to find relevant articles and guides.
3.  **`db_retrieval_agent`**: Searches a BigQuery database of historical tickets to find similar past issues and their resolutions.
4.  **`problem_solver_agent`**: Synthesizes all gathered context to provide a detailed, step-by-step solution for configuration, conceptual, or error-related issues.
5.  **`code_generator_agent`**: Synthesizes context to generate complete, high-quality code examples and applications, especially when a user asks "how to build..." something.

## Setup and Installation

Follow these steps to set up the project environment and all necessary data backends.

### 1. Prerequisites

-   Python 3.11+
-   [Poetry](https://python-poetry.org/docs/) for dependency management.
-   A Google Cloud Project with the AI Platform API enabled.
-   The [Google Cloud SDK](https://cloud.google.com/sdk/docs/install) installed and authenticated (`gcloud auth application-default login`).

### 2. Configure Environment Variables

Copy the example environment file. **This is a mandatory step.**

```bash
cp .env.example .env
```

Now, edit the newly created `.env` file with your specific Google Cloud project details.

```dotenv
# .env
GOOGLE_GENAI_USE_VERTEXAI=1
GOOGLE_CLOUD_PROJECT=your-gcp-project-id
GOOGLE_CLOUD_LOCATION=us-central1
GOOGLE_CLOUD_STORAGE_BUCKET=your-gcp-project-id-support-triage
RAG_CORPUS_NAME="" # This will be auto-populated by the setup script
BQ_PROJECT_ID=your-gcp-project-id
BQ_DATASET_ID=support_tickets_dataset
CRM_API_KEY="your-crm-api-key-here" # Optional, not used in core logic
```

**Note:** The `GOOGLE_CLOUD_STORAGE_BUCKET` must be a globally unique name. Using your project ID as a prefix is a good practice to ensure uniqueness.

### 3. Install Dependencies

Use Poetry to create a virtual environment and install all required Python packages.

```bash
poetry install
```

### 4. Run the Automated Environment Setup

This final step runs a shell script that automates the entire backend setup process. It generates mock data and configures your Google Cloud services (BigQuery and RAG).

First, make the script executable:
```bash
chmod +x setup_environment.sh
```

Now, run the script:
```bash
./setup_environment.sh
```

This script will perform the following actions:
1.  **Scrape Docs:** Run `scripts/scrape_adk_docs.py` to build the `data/knowledge_base`.
2.  **Create Mock DB:** Run `scripts/create_mock_db.py` to generate `data/resolved_tickets.csv`.
3.  **Setup BigQuery:** Run `scripts/setup_bigquery.py` to create the dataset and table in your GCP project and upload the CSV data.
4.  **Setup RAG:** Run `scripts/setup_rag.py` to create a GCS bucket, upload the knowledge base, create a Vertex AI RAG Corpus, and **automatically write the new `RAG_CORPUS_NAME` back to your `.env` file.**

After this script completes, your entire backend and data infrastructure will be ready to use.

## Running the Agent

You can interact with the agent using the ADK's built-in web interface.

```bash
# Make sure you are in the project's virtual environment
# poetry shell

adk web
```

Navigate to `http://localhost:8000` in your browser and select the `intelligent_support_triage` agent from the dropdown menu.

### Example Interactions

-   **Problem Solving:** "My deployment is failing with a 403 Permission Denied error."
-   **Code Generation:** "Write me an agent that uses a custom tool to get the current weather."
-   **Conversational:** "Hello, what can you do?"

## Project Structure

A brief overview of the key directories:

-   `intelligent_support_triage/`: Contains the core source code for the agent.
    -   `agent.py`: Defines the main orchestrator agent.
    -   `prompts.py`: Holds the instructional prompts for the agents.
    -   `entities/`: Pydantic models for data structures like `SupportTicket`.
    -   `sub_agents/`: Contains the definitions for all specialist agents.
    -   `tools/`: Home for custom Python function tools.
-   `scripts/`: Holds all automation scripts for setting up the environment.
-   `data/`: Contains the raw data for the knowledge base and historical tickets.
-   `deployment/`: Includes scripts for deploying the agent to Vertex AI Agent Engine.

## Disclaimer

This is a demonstration project and is not intended for production use without further testing and hardening.